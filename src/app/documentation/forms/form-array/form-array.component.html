<div class="doc-container">
  <nav class="breadcrumb">
    <a routerLink="/home">üè† Accueil</a>
    <span class="separator">‚Ä∫</span>
    <a routerLink="/documentation">üìö Documentation</a>
    <span class="separator">‚Ä∫</span>
    <span class="current">FormArray</span>
  </nav>

  <header class="doc-header">
    <h1>üìã FormArray - Tableaux Dynamiques</h1>
    <p class="lead">G√©rer des listes de contr√¥les dynamiques qui peuvent √™tre ajout√©s ou supprim√©s</p>
  </header>

  <section class="doc-section">
    <h2>Qu'est-ce qu'un FormArray ?</h2>
    <p>
      <strong>FormArray</strong> est une structure de donn√©es Angular qui g√®re un tableau de contr√¥les de formulaire. Contrairement √† FormGroup qui a des cl√©s fixes, FormArray permet d'ajouter et de supprimer des contr√¥les dynamiquement par index.
    </p>

    <div class="info-box">
      <h3>üéØ Cas d'usage</h3>
      <ul>
        @for (useCase of useCases; track useCase) {
          <li>{{ useCase }}</li>
        }
      </ul>
    </div>
  </section>

  <section class="doc-section">
    <h2>Cr√©ation d'un FormArray</h2>
    <div class="code-block">
      <pre><code>import {{ '{' }} FormArray, FormBuilder {{ '}' }} from '&#64;angular/forms';

export class MyComponent {{ '{' }}
  private fb = inject(FormBuilder);

  // M√©thode 1 : Avec FormBuilder
  profileForm = this.fb.group({{ '{' }}
    name: [''],
    skills: this.fb.array([
      this.fb.control('Angular'),
      this.fb.control('TypeScript')
    ])
  {{ '}' }});

  // M√©thode 2 : Constructeur direct
  skills = new FormArray([
    new FormControl('Angular'),
    new FormControl('TypeScript')
  ]);

  // Getter pour acc√©der facilement
  get skills(): FormArray {{ '{' }}
    return this.profileForm.get('skills') as FormArray;
  {{ '}' }}
{{ '}' }}</code></pre>
    </div>
  </section>

  <section class="doc-section">
    <h2>M√©thodes FormArray</h2>
    <div class="methods-grid">
      @for (method of arrayMethods; track method.name) {
        <div class="method-card">
          <h3>{{ method.name }}</h3>
          <p>{{ method.description }}</p>
          <div class="code-inline">
            <code>{{ method.example }}</code>
          </div>
        </div>
      }
    </div>
  </section>

  <section class="doc-section">
    <h2>FormArray avec FormGroups</h2>
    <p>Pour des √©l√©ments complexes, chaque entr√©e du FormArray peut √™tre un FormGroup :</p>
    
    <div class="code-block">
      <pre><code>profileForm = this.fb.group({{ '{' }}
  name: [''],
  skills: this.fb.array([])  // Vide au d√©part
{{ '}' }});

// Cr√©er un FormGroup pour chaque comp√©tence
createSkillFormGroup() {{ '{' }}
  return this.fb.group({{ '{' }}
    name: ['', Validators.required],
    level: ['', Validators.required],
    yearsOfExperience: [0, [Validators.min(0), Validators.max(50)]]
  {{ '}' }});
{{ '}' }}

// Ajouter une comp√©tence
addSkill() {{ '{' }}
  this.skills.push(this.createSkillFormGroup());
{{ '}' }}

// Supprimer une comp√©tence
removeSkill(index: number) {{ '{' }}
  this.skills.removeAt(index);
{{ '}' }}</code></pre>
    </div>
  </section>

  <section class="doc-section">
    <h2>D√©mo Interactive : Gestion de Comp√©tences</h2>
    <div class="demo-box">
      <form [formGroup]="profileForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label>Nom</label>
          <input formControlName="name" placeholder="Votre nom">
        </div>

        <div class="array-section">
          <div class="section-header">
            <h3>Comp√©tences</h3>
            <button type="button" class="btn-add" (click)="addSkill()">
              + Ajouter une comp√©tence
            </button>
          </div>

          <div formArrayName="skills" class="array-items">
            @for (skill of skills.controls; track $index; let i = $index) {
              <div [formGroupName]="i" class="array-item">
                <div class="item-header">
                  <h4>Comp√©tence #{{ i + 1 }}</h4>
                  <button type="button" class="btn-remove" (click)="removeSkill(i)">
                    ‚úï
                  </button>
                </div>

                <div class="item-fields">
                  <div class="form-field">
                    <label>Nom de la comp√©tence</label>
                    <input formControlName="name" placeholder="Ex: Angular">
                  </div>

                  <div class="form-field">
                    <label>Niveau</label>
                    <select formControlName="level">
                      <option value="">S√©lectionner</option>
                      <option value="D√©butant">D√©butant</option>
                      <option value="Interm√©diaire">Interm√©diaire</option>
                      <option value="Avanc√©">Avanc√©</option>
                      <option value="Expert">Expert</option>
                    </select>
                  </div>

                  <div class="form-field">
                    <label>Ann√©es d'exp√©rience</label>
                    <input type="number" formControlName="yearsOfExperience" min="0" max="50">
                  </div>
                </div>
              </div>
            }
            
            @if (skills.length === 0) {
              <p class="empty-message">Aucune comp√©tence ajout√©e. Cliquez sur "Ajouter" pour commencer.</p>
            }
          </div>
        </div>

        <div class="array-section">
          <div class="section-header">
            <h3>Hobbies (Liste simple)</h3>
            <button type="button" class="btn-add" (click)="addHobby()">
              + Ajouter un hobby
            </button>
          </div>

          <div formArrayName="hobbies" class="simple-array">
            @for (hobby of hobbies.controls; track $index; let i = $index) {
              <div class="simple-item">
                <input [formControlName]="i" placeholder="Ex: Lecture">
                <button type="button" class="btn-remove-small" (click)="removeHobby(i)">
                  ‚úï
                </button>
              </div>
            }
            
            @if (hobbies.length === 0) {
              <p class="empty-message">Aucun hobby ajout√©.</p>
            }
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" [disabled]="profileForm.invalid">
            Sauvegarder le profil
          </button>
        </div>
      </form>

      <div class="form-value">
        <h4>Valeur du formulaire :</h4>
        <pre>{{ profileForm.value | json }}</pre>
        <p><strong>Nombre de comp√©tences :</strong> {{ skills.length }}</p>
        <p><strong>Nombre de hobbies :</strong> {{ hobbies.length }}</p>
      </div>
    </div>
  </section>

  <section class="doc-section">
    <h2>It√©ration dans le Template</h2>
    <div class="code-block">
      <pre><code>&lt;!-- Utiliser &#64;for avec formArrayName --&gt;
&lt;div formArrayName="skills"&gt;
  &#64;for (skill of skills.controls; track $index; let i = $index) {{ '{' }}
    &lt;div [formGroupName]="i"&gt;
      &lt;input formControlName="name"&gt;
      &lt;button (click)="removeSkill(i)"&gt;Supprimer&lt;/button&gt;
    &lt;/div&gt;
  {{ '}' }}
&lt;/div&gt;

&lt;!-- Ou avec l'ancienne syntaxe *ngFor --&gt;
&lt;div formArrayName="skills"&gt;
  &lt;div *ngFor="let skill of skills.controls; let i = index" 
       [formGroupName]="i"&gt;
    &lt;input formControlName="name"&gt;
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
    </div>
  </section>

  <section class="doc-section">
    <h2>Bonnes Pratiques</h2>
    <div class="practices-container">
      <div class="practice-card good">
        <h3>‚úÖ √Ä Faire</h3>
        <ul>
          <li>Cr√©er une m√©thode factory pour g√©n√©rer les FormGroups</li>
          <li>Utiliser des getters pour un acc√®s facile au FormArray</li>
          <li>Ajouter des validateurs √† chaque contr√¥le du tableau</li>
          <li>Fournir un bouton clair pour ajouter/supprimer des √©l√©ments</li>
          <li>Limiter le nombre maximum d'√©l√©ments si n√©cessaire</li>
        </ul>
      </div>

      <div class="practice-card bad">
        <h3>‚ùå √Ä √âviter</h3>
        <ul>
          <li>Manipuler directement le tableau de contr√¥les</li>
          <li>Oublier de valider les nouveaux √©l√©ments ajout√©s</li>
          <li>Cr√©er des FormArrays trop complexes (> 3 niveaux)</li>
          <li>Ne pas g√©rer le cas o√π le tableau est vide</li>
          <li>Permettre la suppression sans confirmation (si donn√©es importantes)</li>
        </ul>
      </div>
    </div>
  </section>

  <section class="doc-section">
    <h2>Ressources</h2>
    <div class="resources-list">
      <a href="https://angular.dev/api/forms/FormArray" target="_blank" class="resource-link">
        üìñ API Reference - FormArray
      </a>
      <a href="https://angular.dev/guide/forms/reactive-forms" target="_blank" class="resource-link">
        üìñ Guide - Reactive Forms
      </a>
    </div>
  </section>

  <nav class="doc-navigation">
    <a routerLink="/documentation/forms/validation" class="nav-button prev">‚Üê Validation</a>
    <a routerLink="/documentation" class="nav-button next">Documentation ‚Üí</a>
  </nav>
</div>
