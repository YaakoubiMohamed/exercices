<div class="doc-container">
  <nav class="breadcrumb">
    <a routerLink="/home">üè† Accueil</a>
    <span class="separator">‚Ä∫</span>
    <a routerLink="/documentation">üìö Documentation</a>
    <span class="separator">‚Ä∫</span>
    <span class="current">Validation</span>
  </nav>

  <header class="doc-header">
    <h1>‚úì Validation & Validators</h1>
    <p class="lead">Validation robuste des formulaires avec validators int√©gr√©s et personnalis√©s</p>
  </header>

  <section class="doc-section">
    <h2>Validators Int√©gr√©s</h2>
    <p>Angular fournit un ensemble complet de validators pr√™ts √† l'emploi :</p>
    
    <div class="validators-grid">
      @for (validator of builtInValidators; track validator.name) {
        <div class="validator-card">
          <h3>{{ validator.name }}</h3>
          <p>{{ validator.description }}</p>
          <div class="code-inline">
            <code>{{ validator.example }}</code>
          </div>
        </div>
      }
    </div>
  </section>

  <section class="doc-section">
    <h2>Utilisation des Validators</h2>
    <div class="code-block">
      <pre><code>// Un seul validator
firstName: ['', Validators.required]

// Plusieurs validators
email: ['', [Validators.required, Validators.email]]

// Validator avec param√®tre
username: ['', [
  Validators.required,
  Validators.minLength(3),
  Validators.maxLength(20)
]]

// Validators complexes
age: ['', [
  Validators.required,
  Validators.min(18),
  Validators.max(120),
  Validators.pattern(/^[0-9]+$/)
]]</code></pre>
    </div>
  </section>

  <section class="doc-section">
    <h2>Validators Personnalis√©s</h2>
    <p>Cr√©ez vos propres validators pour des r√®gles de validation sp√©cifiques :</p>
    
    <div class="code-block">
      <pre><code>// Fonction validator personnalis√©e
function passwordStrengthValidator(
  control: AbstractControl
): ValidationErrors | null {{ '{' }}
  const value = control.value;
  if (!value) return null;

  const hasNumber = /[0-9]/.test(value);
  const hasUpper = /[A-Z]/.test(value);
  const hasLower = /[a-z]/.test(value);
  const hasSpecial = /[!&#64;#$%^&*()]/.test(value);

  const valid = hasNumber && hasUpper && hasLower && hasSpecial;
  
  return valid ? null : {{ '{' }} passwordStrength: true {{ '}' }};
{{ '}' }}

// Utilisation
password: ['', [
  Validators.required,
  Validators.minLength(8),
  passwordStrengthValidator
]]</code></pre>
    </div>
  </section>

  <section class="doc-section">
    <h2>Afficher les Erreurs</h2>
    <div class="code-block">
      <pre><code>&lt;!-- Template --&gt;
&lt;input formControlName="email"&gt;

&lt;!-- Afficher les erreurs --&gt;
&#64;if (userForm.get('email')?.invalid && userForm.get('email')?.touched) {{ '{' }}
  &lt;div class="error"&gt;
    &#64;if (userForm.get('email')?.errors?.['required']) {{ '{' }}
      L'email est requis
    {{ '}' }}
    &#64;if (userForm.get('email')?.errors?.['email']) {{ '{' }}
      Format email invalide
    {{ '}' }}
  &lt;/div&gt;
{{ '}' }}</code></pre>
    </div>

    <div class="code-block">
      <pre><code>// M√©thode dans le composant
getErrorMessage(controlName: string): string {{ '{' }}
  const control = this.form.get(controlName);
  if (!control || !control.errors || !control.touched) return '';

  if (control.errors['required']) return 'Ce champ est obligatoire';
  if (control.errors['email']) return 'Email invalide';
  if (control.errors['minlength']) {{ '{' }}
    return `Minimum ${{ '{' }}control.errors['minlength'].requiredLength{{ '}' }} caract√®res`;
  {{ '}' }}
  
  return 'Erreur de validation';
{{ '}' }}

&lt;!-- Template --&gt;
&lt;span class="error"&gt;{{ '{' }}{{ '{' }} getErrorMessage('email') {{ '}' }}{{ '}' }}&lt;/span&gt;</code></pre>
    </div>
  </section>

  <section class="doc-section">
    <h2>D√©mo Interactive</h2>
    <div class="demo-box">
      <form [formGroup]="registrationForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label>Nom d'utilisateur *</label>
          <input formControlName="username" placeholder="3-20 caract√®res">
          <span class="error">{{ getErrorMessage('username') }}</span>
        </div>

        <div class="form-group">
          <label>Email *</label>
          <input type="email" formControlName="email" placeholder="user&#64;example.com">
          <span class="error">{{ getErrorMessage('email') }}</span>
        </div>

        <div class="form-group">
          <label>Mot de passe *</label>
          <input type="password" formControlName="password" placeholder="Min 8 caract√®res">
          <span class="error">{{ getErrorMessage('password') }}</span>
          @if (registrationForm.get('password')?.errors?.['passwordStrength']) {
            <div class="info-box-small">
              Le mot de passe doit contenir :
              <ul>
                <li>Au moins une majuscule</li>
                <li>Au moins une minuscule</li>
                <li>Au moins un chiffre</li>
                <li>Au moins un caract√®re sp√©cial</li>
              </ul>
            </div>
          }
        </div>

        <div class="form-group">
          <label>Confirmer le mot de passe *</label>
          <input type="password" formControlName="confirmPassword">
          <span class="error">{{ getErrorMessage('confirmPassword') }}</span>
        </div>

        <div class="form-group">
          <label>√Çge *</label>
          <input type="number" formControlName="age" placeholder="18-120">
          <span class="error">{{ getErrorMessage('age') }}</span>
        </div>

        <div class="form-group">
          <label>Site web</label>
          <input formControlName="website" placeholder="https://example.com">
          <span class="error">{{ getErrorMessage('website') }}</span>
        </div>

        <div class="form-group checkbox-group">
          <label>
            <input type="checkbox" formControlName="terms">
            J'accepte les conditions d'utilisation *
          </label>
          <span class="error">{{ getErrorMessage('terms') }}</span>
        </div>

        <button type="submit" [disabled]="registrationForm.invalid">
          S'inscrire
        </button>
      </form>

      <div class="form-status">
        <h4>√âtat du formulaire :</h4>
        <ul>
          <li>Valide : <strong [class.text-success]="registrationForm.valid" [class.text-error]="registrationForm.invalid">{{ registrationForm.valid }}</strong></li>
          <li>Touch√© : <strong>{{ registrationForm.touched }}</strong></li>
          <li>Modifi√© : <strong>{{ registrationForm.dirty }}</strong></li>
        </ul>
      </div>
    </div>
  </section>

  <section class="doc-section">
    <h2>Validation Asynchrone</h2>
    <p>Pour des validations qui n√©cessitent des appels serveur (ex: v√©rifier si un username existe) :</p>
    
    <div class="code-block">
      <pre><code>// Validator asynchrone
function usernameExistsValidator(
  userService: UserService
): AsyncValidatorFn {{ '{' }}
  return (control: AbstractControl): Observable&lt;ValidationErrors | null&gt; => {{ '{' }}
    if (!control.value) {{ '{' }}
      return of(null);
    {{ '}' }}
    
    return userService.checkUsername(control.value).pipe(
      map(exists => exists ? {{ '{' }} usernameExists: true {{ '}' }} : null),
      catchError(() => of(null))
    );
  {{ '}' }};
{{ '}' }}

// Utilisation (3√®me param√®tre = validators asynchrones)
username: ['', 
  [Validators.required],  // Sync validators
  [usernameExistsValidator(this.userService)]  // Async validators
]</code></pre>
    </div>
  </section>

  <section class="doc-section">
    <h2>Bonnes Pratiques</h2>
    <div class="practices-container">
      <div class="practice-card good">
        <h3>‚úÖ √Ä Faire</h3>
        <ul>
          <li>Valider √† la fois c√¥t√© client ET serveur</li>
          <li>Afficher les erreurs uniquement apr√®s touched</li>
          <li>Cr√©er des messages d'erreur clairs et utiles</li>
          <li>Centraliser les validators personnalis√©s r√©utilisables</li>
          <li>D√©sactiver le bouton submit si le formulaire est invalide</li>
        </ul>
      </div>

      <div class="practice-card bad">
        <h3>‚ùå √Ä √âviter</h3>
        <ul>
          <li>Se fier uniquement √† la validation c√¥t√© client</li>
          <li>Afficher toutes les erreurs d√®s le chargement</li>
          <li>Messages d'erreur techniques incompr√©hensibles</li>
          <li>Validators asynchrones trop fr√©quents (performance)</li>
          <li>Oublier de g√©rer les erreurs des validators asynchrones</li>
        </ul>
      </div>
    </div>
  </section>

  <section class="doc-section">
    <h2>Ressources</h2>
    <div class="resources-list">
      <a href="https://angular.dev/api/forms/Validators" target="_blank" class="resource-link">
        üìñ API Reference - Validators
      </a>
      <a href="https://angular.dev/guide/forms/form-validation" target="_blank" class="resource-link">
        üìñ Guide - Form Validation
      </a>
    </div>
  </section>

  <nav class="doc-navigation">
    <a routerLink="/documentation/forms/form-builder" class="nav-button prev">‚Üê FormBuilder</a>
    <a routerLink="/documentation/forms/form-array" class="nav-button next">FormArray ‚Üí</a>
  </nav>
</div>
