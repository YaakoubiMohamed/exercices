<div class="explanation-container">
  <!-- Header -->
  <header class="explanation-header">
    <a routerLink="/exercice4" class="back-link">â† Retour Ã  l'application</a>
    <h1>
      <span class="icon">ğŸ“š</span>
      Guide Pas Ã  Pas : Application MÃ©tÃ©o
    </h1>
    <p class="subtitle">
      Comprendre la construction d'une application Angular avec HttpClient, RxJS et architecture moderne
    </p>
  </header>

  <!-- Concepts clÃ©s -->
  <section class="key-concepts">
    <h2>ğŸ¯ Concepts ClÃ©s Couverts</h2>
    <div class="concepts-grid">
      <div class="concept-card">
        <span class="concept-icon">ğŸŒ</span>
        <h3>HttpClient</h3>
        <p>Appels API REST avec Angular</p>
      </div>
      <div class="concept-card">
        <span class="concept-icon">ğŸ”„</span>
        <h3>RxJS</h3>
        <p>OpÃ©rateurs: debounceTime, switchMap, catchError</p>
      </div>
      <div class="concept-card">
        <span class="concept-icon">ğŸ›¡ï¸</span>
        <h3>Interceptors</h3>
        <p>Gestion centralisÃ©e des erreurs HTTP</p>
      </div>
      <div class="concept-card">
        <span class="concept-icon">ğŸ”§</span>
        <h3>Pipes</h3>
        <p>Transformation de donnÃ©es personnalisÃ©e</p>
      </div>
      <div class="concept-card">
        <span class="concept-icon">ğŸ’¾</span>
        <h3>LocalStorage</h3>
        <p>Persistance des favoris</p>
      </div>
      <div class="concept-card">
        <span class="concept-icon">ğŸ“Š</span>
        <h3>State Management</h3>
        <p>BehaviorSubject pour l'Ã©tat</p>
      </div>
    </div>
  </section>

  <!-- Architecture -->
  <section class="architecture-section">
    <h2>ğŸ—ï¸ Architecture de l'Application</h2>
    <div class="architecture-diagram">
      <pre>{{ architectureDiagram }}</pre>
    </div>
  </section>

  <!-- Steps -->
  <section class="steps-section">
    <h2>ğŸ“‹ Ã‰tapes de DÃ©veloppement</h2>
    
    @for (step of steps; track step.number) {
      <div class="step-card">
        <div class="step-header">
          <div class="step-number">{{ step.number }}</div>
          <div class="step-title-section">
            <span class="step-icon">{{ step.icon }}</span>
            <h3>{{ step.title }}</h3>
          </div>
        </div>
        
        <p class="step-description">{{ step.description }}</p>
        
        <div class="step-concepts">
          @for (concept of step.concepts; track concept) {
            <span class="concept-tag">{{ concept }}</span>
          }
        </div>
        
        <details class="code-details">
          <summary>Voir le code</summary>
          <pre class="code-block"><code>{{ step.code }}</code></pre>
        </details>
      </div>
    }
  </section>

  <!-- Flux de donnÃ©es -->
  <section class="data-flow-section">
    <h2>ğŸ”€ Flux de DonnÃ©es</h2>
    
    <div class="flow-diagram">
      <div class="flow-step">
        <div class="flow-icon">ğŸ‘¤</div>
        <div class="flow-content">
          <h4>1. Utilisateur tape une ville</h4>
          <p>Input avec FormControl</p>
        </div>
      </div>
      
      <div class="flow-arrow">â†“</div>
      
      <div class="flow-step">
        <div class="flow-icon">â±ï¸</div>
        <div class="flow-content">
          <h4>2. Debounce (500ms)</h4>
          <p>Ã‰vite les requÃªtes inutiles</p>
        </div>
      </div>
      
      <div class="flow-arrow">â†“</div>
      
      <div class="flow-step">
        <div class="flow-icon">ğŸ”„</div>
        <div class="flow-content">
          <h4>3. switchMap</h4>
          <p>Annule la requÃªte prÃ©cÃ©dente, lance la nouvelle</p>
        </div>
      </div>
      
      <div class="flow-arrow">â†“</div>
      
      <div class="flow-step">
        <div class="flow-icon">ğŸŒ</div>
        <div class="flow-content">
          <h4>4. HttpClient GET</h4>
          <p>RequÃªte Ã  OpenWeatherMap API</p>
        </div>
      </div>
      
      <div class="flow-arrow">â†“</div>
      
      <div class="flow-step">
        <div class="flow-icon">ğŸ›¡ï¸</div>
        <div class="flow-content">
          <h4>5. Interceptor</h4>
          <p>Log + gestion erreurs centralisÃ©e</p>
        </div>
      </div>
      
      <div class="flow-arrow">â†“</div>
      
      <div class="flow-step">
        <div class="flow-icon">ğŸ”§</div>
        <div class="flow-content">
          <h4>6. Transform (map)</h4>
          <p>API response â†’ WeatherData</p>
        </div>
      </div>
      
      <div class="flow-arrow">â†“</div>
      
      <div class="flow-step">
        <div class="flow-icon">ğŸ“Š</div>
        <div class="flow-content">
          <h4>7. BehaviorSubject</h4>
          <p>Met Ã  jour l'Ã©tat (loading/success/error)</p>
        </div>
      </div>
      
      <div class="flow-arrow">â†“</div>
      
      <div class="flow-step">
        <div class="flow-icon">ğŸ–¥ï¸</div>
        <div class="flow-content">
          <h4>8. Async Pipe</h4>
          <p>Affichage dans le template</p>
        </div>
      </div>
    </div>
  </section>

  <!-- RÃ©sumÃ© RxJS -->
  <section class="rxjs-section">
    <h2>ğŸ”„ OpÃ©rateurs RxJS UtilisÃ©s</h2>
    
    <div class="operators-grid">
      <div class="operator-card">
        <h4>debounceTime(500)</h4>
        <p>Attend 500ms aprÃ¨s la derniÃ¨re Ã©mission avant de continuer. Ã‰vite les requÃªtes Ã  chaque frappe.</p>
        <code>input: a-b-c----d-e-f----<br>output: --------c--------f</code>
      </div>
      
      <div class="operator-card">
        <h4>distinctUntilChanged()</h4>
        <p>N'Ã©met que si la valeur est diffÃ©rente de la prÃ©cÃ©dente.</p>
        <code>input: a-a-b-b-b-c-a<br>output: a---b-----c-a</code>
      </div>
      
      <div class="operator-card">
        <h4>switchMap()</h4>
        <p>Annule la requÃªte prÃ©cÃ©dente et switch vers la nouvelle. IdÃ©al pour les recherches.</p>
        <code>RequÃªte 1 en cours...<br>Nouvelle recherche â†’ Annule 1, lance 2</code>
      </div>
      
      <div class="operator-card">
        <h4>catchError()</h4>
        <p>Intercepte les erreurs et permet de les gÃ©rer proprement sans casser le flux.</p>
        <code>error â†’ return of(fallbackValue)</code>
      </div>
      
      <div class="operator-card">
        <h4>map()</h4>
        <p>Transforme chaque valeur Ã©mise. UtilisÃ© pour convertir la rÃ©ponse API.</p>
        <code>apiResponse â†’ WeatherData</code>
      </div>
      
      <div class="operator-card">
        <h4>shareReplay(1)</h4>
        <p>Partage le rÃ©sultat entre tous les abonnÃ©s. Ã‰vite les requÃªtes multiples.</p>
        <code>1 requÃªte â†’ N abonnÃ©s</code>
      </div>
    </div>
  </section>

  <!-- Fichiers du projet -->
  <section class="files-section">
    <h2>ğŸ“ Structure des Fichiers</h2>
    
    <div class="file-tree">
      <pre>
exercice4-weather/
â”œâ”€â”€ ğŸ“ models/
â”‚   â””â”€â”€ weather.models.ts        # Interfaces TypeScript
â”œâ”€â”€ ğŸ“ services/
â”‚   â”œâ”€â”€ weather.service.ts       # Logique API + RxJS
â”‚   â””â”€â”€ favorites.service.ts     # Gestion favoris + LocalStorage
â”œâ”€â”€ ğŸ“ pipes/
â”‚   â””â”€â”€ temperature.pipe.ts      # Pipe Â°C/Â°F
â”œâ”€â”€ ğŸ“ interceptors/
â”‚   â””â”€â”€ weather.interceptor.ts   # Gestion erreurs HTTP
â”œâ”€â”€ ğŸ“ components/
â”‚   â”œâ”€â”€ weather-search.component.ts
â”‚   â”œâ”€â”€ weather-display.component.ts
â”‚   â”œâ”€â”€ favorites.component.ts
â”‚   â”œâ”€â”€ weather-forecast.component.ts
â”‚   â””â”€â”€ weather-explanation.component.ts
â”œâ”€â”€ weather.component.ts         # Composant principal
â”œâ”€â”€ weather.component.html
â””â”€â”€ weather.component.css
      </pre>
    </div>
  </section>

  <!-- KEYWORDS GLOSSARY -->
  <section class="keywords-section">
    <h2>ğŸ“– Glossaire des Mots-ClÃ©s</h2>
    <p class="keywords-intro">
      Explication dÃ©taillÃ©e de tous les mots-clÃ©s Angular, RxJS et TypeScript utilisÃ©s dans cet exercice.
    </p>
    
    @for (category of keywords; track category.category) {
      <div class="keyword-category">
        <h3 class="category-title">{{ category.category }}</h3>
        
        @for (item of category.items; track item.keyword) {
          <div class="keyword-card">
            <div class="keyword-header">
              <code class="keyword-name">{{ item.keyword }}</code>
            </div>
            
            <div class="keyword-body">
              <p class="keyword-description">{{ item.description }}</p>
              
              <details class="keyword-details">
                <summary>ğŸ“ Exemple de code</summary>
                <pre class="keyword-code"><code>{{ item.example }}</code></pre>
              </details>
              
              <div class="keyword-usage">
                <strong>ğŸ’¡ Utilisation :</strong> {{ item.usage }}
              </div>
            </div>
          </div>
        }
      </div>
    }
  </section>

  <!-- Footer -->
  <footer class="explanation-footer">
    <a routerLink="/exercice4" class="btn-back">
      â† Retour Ã  l'Application MÃ©tÃ©o
    </a>
    <a routerLink="/home" class="btn-home">
      ğŸ  Accueil
    </a>
  </footer>
</div>
